Summary: OCI runtime written in C
Name: crun
Epoch: 101
Version: @RPM_VERSION@
%define build_timestamp %{lua: print(os.date("%Y%m%d%H%M%S"))}
Release: %{build_timestamp}%{?dist}
# `make tarball-prep` will generate this from HEAD commit in the repo root dir
Source0: %{name}-latest.tar.gz
License: GPLv2+
URL: https://github.com/containers/%{name}

BuildRequires: autoconf
BuildRequires: automake
BuildRequires: gcc
BuildRequires: python
BuildRequires: git-core
BuildRequires: libcap-devel
BuildRequires: libkrun-devel
BuildRequires: systemd-devel
BuildRequires: yajl-devel
BuildRequires: libseccomp-devel
BuildRequires: python3-libmount
BuildRequires: libtool
BuildRequires: go-md2man

%description
%{name} is a OCI runtime

%package -n krun
Summary: %{name} with libkrun support
Requires: libkrun

%description -n krun
krun is a symlink to the crun binary, with libkrun as an additional dependency.

%prep
%autosetup -n %{name}-@VERSION@

%build
# autogen.sh and configure are run via Makefile
%make_build

%install
%make_install
rm -rf %{buildroot}%{_usr}/lib*

ln -s %{_bindir}/%{name} %{buildroot}%{_bindir}/krun

%files
%license COPYING
%{_bindir}/%{name}
%{_mandir}/man1/*

%files -n krun
%license COPYING
%{_bindir}/krun

%if ! 0%{?centos} <= 8
%changelog
%autochangelog
%endif
